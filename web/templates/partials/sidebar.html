{% set r = (role|default('')|lower) %}
{% set path = request.path %}
{% set is_admin = (r == 'admin') %}
{% set is_supervisor = (r == 'supervisor') %}
{% set is_vendedor = (r == 'vendedor') %}
{% set is_financeiro = (r == 'financeiro') %}

<div class="sv-sidebar">
  <div class="sv-sidebar-brand">
    <div class="sv-sidebar-logo">
      {% if branding and branding.logo_url %}
        <img src="{{ branding.logo_url }}{% if branding.version %}?v={{ branding.version }}{% endif %}" alt="Logo">
      {% else %}
        <div class="sv-logo-fallback">SV</div>
      {% endif %}
    </div>
    <div class="sv-sidebar-titles">
      <div class="sv-sidebar-title">{{ branding.system_name if branding and branding.system_name else "VeipeÃ§as" }}</div>
      {% if emp %}
        <div class="sv-sidebar-subtitle">EMP {{ emp }}</div>
      {% endif %}
    </div>
  </div>

  <nav class="sv-nav">
    <a class="sv-nav-item {% if path.startswith('/dashboard') or path=='/' %}active{% endif %}" href="/dashboard">
      <span class="sv-ico">ğŸ“Š</span><span class="sv-text">Dashboard</span>
    </a>

    <div class="sv-nav-section">RelatÃ³rios</div>
    <a class="sv-nav-item {% if path.startswith('/relatorios/campanhas') %}active{% endif %}" href="/relatorios/campanhas">
      <span class="sv-ico">ğŸ¯</span><span class="sv-text">Campanhas</span>
    </a>
    <a class="sv-nav-item {% if path.startswith('/relatorios/cidades-clientes') %}active{% endif %}" href="/relatorios/cidades-clientes">
      <span class="sv-ico">ğŸ™ï¸</span><span class="sv-text">Cidades & Clientes</span>
    </a>

    <div class="sv-nav-section">OperaÃ§Ã£o</div>
    <a class="sv-nav-item {% if path.startswith('/campanhas') and not path.startswith('/relatorios') %}active{% endif %}" href="/campanhas">
      <span class="sv-ico">â­</span><span class="sv-text">Campanhas (Qtd)</span>
    </a>
    <a class="sv-nav-item {% if path.startswith('/campanhas/ranking-marca') %}active{% endif %}" href="/campanhas/ranking-marca">
      <span class="sv-ico">ğŸ</span><span class="sv-text">Ranking por Marca</span>
    </a>
    <a class="sv-nav-item {% if path.startswith('/metas') %}active{% endif %}" href="/metas">
      <span class="sv-ico">ğŸ¯</span><span class="sv-text">Metas</span>
    </a>
    <a class="sv-nav-item {% if path.startswith('/itens_parados') %}active{% endif %}" href="/itens_parados">
      <span class="sv-ico">ğŸ§¾</span><span class="sv-text">Itens Parados</span>
    </a>
    <a class="sv-nav-item {% if path.startswith('/mensagens') %}active{% endif %}" href="/mensagens">
      <span class="sv-ico">ğŸ“£</span><span class="sv-text">Mensagens</span>
    </a>

    <div class="sv-nav-divider"></div>
    <a class="sv-nav-item {% if path.startswith('/senha') %}active{% endif %}" href="/senha">
      <span class="sv-ico">ğŸ”‘</span><span class="sv-text">Trocar senha</span>
    </a>

    {% if is_financeiro or is_admin %}
      <div class="sv-nav-section">Financeiro</div>
      <a class="sv-nav-item {% if path.startswith('/financeiro/campanhas_v2') %}active{% endif %}" href="/financeiro/campanhas_v2">
        <span class="sv-ico">ğŸ’°</span><span class="sv-text">Campanhas (Fin.)</span>
      </a>
      <a class="sv-nav-item {% if path.startswith('/financeiro/fechamento_v2') %}active{% endif %}" href="/financeiro/fechamento_v2">
        <span class="sv-ico">âœ…</span><span class="sv-text">Fechamento (V2)</span>
      </a>
      <a class="sv-nav-item {% if path.startswith('/admin/fechamento') %}active{% endif %}" href="/admin/fechamento">
        <span class="sv-ico">ğŸ—“ï¸</span><span class="sv-text">Fechamento (MÃªs)</span>
      </a>
    {% endif %}

    {% if is_admin %}
      <div class="sv-nav-section">Admin</div>
      <a class="sv-nav-item {% if path.startswith('/admin/usuarios') %}active{% endif %}" href="/admin/usuarios">
        <span class="sv-ico">ğŸ‘¤</span><span class="sv-text">UsuÃ¡rios</span>
      </a>
      <a class="sv-nav-item {% if path.startswith('/admin/emps') %}active{% endif %}" href="/admin/emps">
        <span class="sv-ico">ğŸ¬</span><span class="sv-text">EMPs</span>
      </a>
      <a class="sv-nav-item {% if path.startswith('/admin/campanhas') %}active{% endif %}" href="/admin/campanhas_v2">
        <span class="sv-ico">ğŸ§©</span><span class="sv-text">Campanhas (Admin)</span>
      </a>
      <a class="sv-nav-item {% if path.startswith('/admin/combos') %}active{% endif %}" href="/admin/combos">
        <span class="sv-ico">ğŸ§±</span><span class="sv-text">Combos</span>
      </a>
      <a class="sv-nav-item {% if path.startswith('/admin/configuracoes') %}active{% endif %}" href="/admin/configuracoes">
        <span class="sv-ico">âš™ï¸</span><span class="sv-text">ConfiguraÃ§Ãµes</span>
      </a>
    {% endif %}
  </nav>

  <div class="sv-sidebar-footer">
    <button class="sv-btn sv-btn-ghost" type="button" id="sidebarToggleSidebar">
      <span class="sv-ico">â˜°</span><span class="sv-text">Recolher</span>
    </button>
  </div>
</div>
